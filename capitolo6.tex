Nei capitoli precedenti abbiamo esaminato i fondamenti teorici della crittograifa
post-quantistica e gli algoritmi standardizzati dal NIST\@. Il peridio 2023--2025
ha segnato però un passaggio decisivo: da casi di studio a implementazioni su scala globale.

Aziende come Google, Apple, Cloudflare e Signal hanno già distribuito protocolli
ibridi ai propri utenti, mentre la NSA ha pubblicato una tablle di marcia vincolante 
per tutti i sistemi classificati statunitensi. 
Questo capitolo analizza le principali implementazioni reali, la strategia ibrida 
che li accomuna e le sfide emerse in fase di distribuzione.

%----------------------------------------------------------------------------------------
\section[L'approccio ibrido]{L'approccio ibrido: PQC più crittografia classica}

Tutte le implementazioni che discuteremo condividono una scelta architetturale fondatamentale:
non sostituire completamente la crittografia classica on quella pqc, ma parallelizzarle in uno
stato ibrido. La motivazione è Bivalente. 

In primo lugo la prudenza scientifica. Gli algoritmi PQC standardizzati nel 2024 sono stati
sottoposti a un processo di revisione pubblica senza precedenti, ma non possono vantare
la stessa profondità di analisi crittoanalitica accumulata a ECC o RSA in decenni di uso. 
L'approccio ibrido quindi garantisce che la sicurezza complessiva non sia inferiore di quella
classica, anche nell'ipotetica eventualità che una vulnerabilità venisse scoperta nei nuovi algoritmi. 

Dall'altro lato, la protezione conntro il modello di minaccia \textit{harvest now, decrypt later}
di cui abbiamo parlato nel Capitolo~\ref{chap:Crittografia post quantistica} richiede che i dati siano 
protetti con algoritmi resistenti ai quantistici fin da subito, anche se la minaccia è solo potenziale.
Aggiungendo un layer ML-KEM difianco ad un classico, anche il traffico passato è al sicuro da attacchi, 
poiché un futuro attacante quantistico dovrebbe violare entrambi i protocolli. 

Il costo di questa scelta è un aumento della dimensione dei messaggi e un lieve overhead computazionale, 
che le implementazioni concrete hanno dimostrate essere accettabile nella pratica. 

%----------------------------------------------------------------------------------------
\section{Signal: PQXDH e il Triple Retchet}

Signal è un’app di messaggistica istantanea che ha fatto della privacy e della sicurezza il suo intero scopo di vita
ed infatti è stata la prima a deployare la crittografia post-quantistica su larga scala. Nel settembre 2023, 
la Signal Foundation ha annunciato l'aggiornamento del prodocollo di handshake da X3DH
(\textit{Extended Triple Diffie-Hellman}) a PQXDH
(\textit{Post-Quantum Extended Diffie-Hellman})~\cite{signal_pqxdh}.

\paragraph{Architettura di PQXDH.}
Il protocollo X3DH originale derivava un segreto condiviso combinando quattro scambi Diffie-Hellman su
curve ellittiche. PQXDH aggiunge un ulteriore segreto ottenuto tramite CRYSTALS-Kyber (ora ML-KEM), 
mescolando la chiave inizale tramite una funzione derivazione: 
\[
    SK = \mathrm{KDF}(\,DH_1 \,\|\, DH_2 \,\|\, DH_3 \,\|\, DH_4 \,\|\, SS_{\mathrm{KEM}}\,)
\]
dove $SS_{\mathrm{KEM}}$ è il segreto derivato dall'incapsulamento ML-KEM\@.
La scelta di combianre i due segretii -- piuttosto di sostituire l'uno con l'altro --
implica che un attaccante deve violare sia X25519 che ML-KEM per compromettere la sessione~\cite{signal_pqxdh}.

PQXDH usa Kyber-1024 (livello di sicurezza equivalente ad AES-256) e fornisce
\textit{post-quantum forward secrecy} grazie all'uso di chiavi pre-pubblicate
monouso (\textit{one-time prekeys}) che vengono cancellate dopo l'uso. Tuttavia,
nella prima revisione del protocollo l'autenticazione delle chiavi di identità
restava affidata a ECDSA -- un punto su cui si prevedono evoluzioni future per
resistere anche ad avversari quantistici attivi~\cite{signal_pqxdh}.

\paragraph{Dal Double Ratchet al Triple Ratchet.}
PQXDH protegge la fase di handshake iniziale, ma il \textit{Double Ratchet} --
il meccanismo che fornisce forward secrecy e post-compromise security durante
l'intera conversazione -- rimaneva classico. Per colmare questo gap, Signal ha
successivamente sviluppato il \textit{Triple Ratchet}, che integra un ratchet
post-quantistico basato su ML-KEM a fianco dei due ratchet classici esistenti.
La sfida tecnica principale era mantenere i messaggi di protocollo a dimensioni
comparabili a quelle attuali (circa 36 byte), un vincolo imposto dall'efficienza
della rete~\cite{signal_spqr}.

%----------------------------------------------------------------------------------------
\section{Apple: il protocollo PQ3 per iMessage}

Nel febbraio 2024, Apple ha annunciato PQ3, definendolo come il più significativo
aggiornamento crittografico nella storia di iMessage~\cite{apple_pq3}. PQ3 è
notevole non solo per la sua solidità tecnica, ma anche per la scala di deployment:
centinaia di milioni di dispositivi in tutto il mondo hanno ricevuto automaticamente
il nuovo protocollo con l'aggiornamento a iOS~17.4, iPadOS~17.4, macOS~14.4 e
watchOS~10.4.

\paragraph{La tassonomia dei livelli di sicurezza.}
Apple ha introdotto una propria classificazione per confrontare i protocolli di
messaggistica:
\begin{itemize}
    \item \textbf{Livello 1}: crittografia end-to-end classica, senza protezione
          post-quantistica (es. iMessage precedente al 2024).
    \item \textbf{Livello 2}: PQC applicata solo all'handshake iniziale, senza
          rekeying post-quantistico continuo (es. Signal con PQXDH).
    \item \textbf{Livello 3}: PQC applicata sia all'handshake che a tutta la
          conversazione, con rekeying automatico post-quantistico (PQ3).
\end{itemize}
PQ3 è il primo protocollo di messaggistica ampiamente distribuito a raggiungere
il Livello~3~\cite{apple_pq3}.

\paragraph{Architettura di PQ3.}
Ogni dispositivo genera una coppia di chiavi ML-KEM aggiuntiva durante la
registrazione iMessage, pubblicandola sui server Apple insieme alle chiavi
ECC esistenti. Questo consente al mittente di stabilire un'iniziale chiave
post-quantistica anche quando il destinatario è offline.

Per l'ongoing key establishment, PQ3 implementa un meccanismo di rekeying
periodico integrato nel flusso dei messaggi: nuove chiavi ML-KEM vengono
inviate all'interno della conversazione e usate per derivare chiavi di
cifratura \textit{forward secret}, garantendo che la compromissione di una
chiave in un dato momento non comprometta né i messaggi passati né quelli
futuri. Il rekeying avviene al più ogni 50 messaggi o almeno una volta ogni
sette giorni~\cite{apple_pq3}.

Il protocollo mantiene un approccio ibrido: ECC e ML-KEM coesistono, così che
la sicurezza complessiva non sia mai inferiore a quella di ECC soltanto.
L'autenticazione dell'identità degli utenti rimane affidata a ECDSA, in quanto
i chip \textit{Secure Enclave} dei dispositivi Apple non supportano ancora
algoritmi post-quantistici per la firma -- un'area di sviluppo futuro identificata
da Apple come ``Livello 4''~\cite{apple_pq3_analysis}.

%----------------------------------------------------------------------------------------
\section{Google Chrome e Cloudflare: PQC nel protocollo TLS}

La protezione delle connessioni HTTPS è il caso d'uso con il maggiore impatto
immediato, essendo TLS il protocollo su cui si fonda la sicurezza dell'intero
web. Google e Cloudflare hanno guidato la transizione in questo ambito.

\paragraph{Chrome: da X25519Kyber768 a ML-KEM768.}
Nell'agosto 2023, Google ha abilitato in Chrome~116 il supporto
per l'algoritmo ibrido \texttt{X25519Kyber768}, combinando lo scambio di chiave
classico X25519 con Kyber-768 per proteggere il traffico TLS~1.3 contro
attacchi \textit{store-now-decrypt-later}~\cite{google_chrome_pqc}.

Con Chrome~124 (aprile 2024), il meccanismo è stato abilitato per impostazione
predefinita per tutti gli utenti desktop. Il passaggio ha immediatamente rivelato
un problema di compatibilità pratica: il messaggio TLS \textit{ClientHello},
che normalmente rientrava in un singolo pacchetto TCP, aumentava di dimensione
a causa delle chiavi post-quantistiche più grandi, causando errori di connessione
su server, proxy e firewall che non gestivano correttamente messaggi segmentati su
più pacchetti~\cite{chrome_compatibility}.

Con Chrome~131 (novembre 2024), Google ha completato la transizione allo standard
definitivo, adottando \texttt{ML-KEM768+X25519} (codepoint TLS \texttt{0x11EC}),
in sostituzione del precedente \texttt{Kyber768+X25519} (codepoint \texttt{0x6399}).
Le due varianti sono incompatibili tra loro, rendendo necessario l'aggiornamento
coordinato di client e server~\cite{google_mlkem}.